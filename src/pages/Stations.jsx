import React,{useEffect,useState} from 'react';import {useAuth} from '../auth/AuthContext';import {Link} from 'react-router-dom';export default function Stations(){const{api,user}=useAuth();const[type,setType]=useState('');const[items,setItems]=useState([]);const[note,setNote]=useState('');const load=async()=>{const{data}=await api.get('/api/stations',{params:{type:type||undefined}});setItems(data)};useEffect(()=>{load()},[]);async function createBooking(st){const startUtc=prompt('Start (UTC ISO) e.g. 2025-09-28T09:00:00Z');const hours=parseInt(prompt('Duration hours e.g. 2')||'1',10);if(!startUtc)return;const endUtc=new Date(new Date(startUtc).getTime()+hours*3600000).toISOString().replace('.000','').replace('Z','Z');try{const{data}=await api.post('/api/bookings',{stationId:st.id,startUtc,endUtc});setNote('Booking created: '+data.id)}catch(e){setNote('Failed: '+(e.response?.data?.error||'Error'))}}return(<div><h2>Stations</h2><input placeholder='Type (AC/DC)' value={type} onChange={e=>setType(e.target.value)}/><button onClick={load}>Filter</button><div>{items.map(s=>(<div key={s.id} style={{border:'1px solid #ddd',padding:8,margin:'8px 0'}}><b>{s.name}</b> [{s.type}] • Slots:{s.totalSlots} • Active:{String(s.active)} • ({s.lat},{s.lng})<div style={{display:'flex',gap:8,marginTop:6}}>{user?.role==='EVOwner'&&<button onClick={()=>createBooking(s)}>Book</button>}{(user?.role==='Backoffice'||user?.role==='StationOperator')&&<Link to={'/schedules/'+s.id}><button>Schedules</button></Link>}</div></div>))}</div><p>{note}</p></div>)}